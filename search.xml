<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>è·¯ç”±</title>
      <link href="/2020/09/01/lu-you/"/>
      <url>/2020/09/01/lu-you/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æˆ‘æµ‹è¯•äº”æ˜Ÿçš„äººã€‚<span class="github-emoji" style="color: transparent;background:no-repeat url(https://github.githubassets.com/images/icons/emoji/unicode/1f604.png?v8) center/contain" data-src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png?v8">ğŸ˜„</span></p></blockquote><img src="/2020/09/01/lu-you/AM.png" class="" title="This is an example image"><blockquote><p>æˆ‘æµ‹è¯•äº”æ˜Ÿçš„äººã€‚</p></blockquote><img src="/2020/09/01/lu-you/AM.png" class="" title="This is an example image"><img src="/2020/09/01/lu-you/ab.png" class="" title="THis is an example image"><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hyperfè·¯ç”± </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hyperfè·¯ç”±</title>
      <link href="/2020/09/01/15956423117442/"/>
      <url>/2020/09/01/15956423117442/</url>
      
        <content type="html"><![CDATA[<h1 id="è·¯ç”±"><a href="#è·¯ç”±" class="headerlink" title="è·¯ç”±"></a>è·¯ç”±</h1><ul><li><p>æœ¬æ¡†æ¶å®šä¹‰çš„è·¯ç”±å‚æ•°å¿…é¡»å’Œæ§åˆ¶å™¨å‚æ•°é”®åã€ç±»å‹ä¿æŒä¸€è‡´ï¼Œå¦åˆ™æ§åˆ¶å™¨æ— æ³•æ¥å—åˆ°ç›¸å…³å‚æ•°</p></li><li><p>æ€»å…±æœ‰ 3 ç§çº§åˆ«çš„ä¸­é—´ä»¶ï¼Œåˆ†åˆ«ä¸º å…¨å±€ä¸­é—´ä»¶ã€ç±»çº§åˆ«ä¸­é—´ä»¶ã€æ–¹æ³•çº§åˆ«ä¸­é—´ä»¶ï¼Œå¦‚æœéƒ½å®šä¹‰äº†è¿™äº›ä¸­é—´ä»¶ï¼Œæ‰§è¡Œé¡ºåºä¸ºï¼šå…¨å±€ä¸­é—´ä»¶ -&gt; ç±»çº§åˆ«ä¸­é—´ä»¶ -&gt; æ–¹æ³•çº§åˆ«ä¸­é—´ä»¶ã€‚</p></li><li><p>å¦‚æœæ³¨å…¥æ—¶å£°æ˜ä¸º PSR-7 æ ‡å‡†çš„ Psr\Http\Message\ServerRequestInterface æ¥å£ï¼Œåˆ™æ¡†æ¶ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºç­‰åŒäº Hyperf\HttpServer\Contract\RequestInterface çš„ Hyperf\HttpServer\Request å¯¹è±¡ã€‚</p></li><li><p>ä½¿ç”¨ input, inputs æ–¹æ³•å¯ä»¥ä»æ•´ä¸ªè¯·æ±‚ä¸­è·å–è¾“å…¥æ•°æ®ï¼ˆåŒ…æ‹¬ Query å‚æ•°ï¼‰ï¼Œè€Œ query(?string $key = null, $default = null) æ–¹æ³•å¯ä»¥åªä»æŸ¥è¯¢å­—ç¬¦ä¸²ä¸­è·å–è¾“å…¥æ•°æ®</p></li><li><p>å¦‚æœè¯·æ±‚çš„ Body æ•°æ®æ ¼å¼æ˜¯ JSONï¼Œåˆ™åªè¦ è¯·æ±‚å¯¹è±¡(Request) çš„ Content-Type Header å€¼ æ­£ç¡®è®¾ç½®ä¸º application/jsonï¼Œå°±å¯ä»¥é€šè¿‡ input(string $key, $default = null) æ–¹æ³•è®¿é—® JSON æ•°æ®ï¼Œä½ ç”šè‡³å¯ä»¥ä½¿ç”¨ ã€Œç‚¹ã€è¯­æ³•æ¥è¯»å– JSON æ•°ç»„</p></li></ul><h2 id="å‚æ•°æ•è·å’Œæ­£åˆ™è¡¨è¾¾å¼"><a href="#å‚æ•°æ•è·å’Œæ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="å‚æ•°æ•è·å’Œæ­£åˆ™è¡¨è¾¾å¼"></a>å‚æ•°æ•è·å’Œæ­£åˆ™è¡¨è¾¾å¼</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">// Matches /user/foo/bar as well</span><span class="token variable">$r</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addRoute</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'/user/{name:.+}'</span><span class="token punctuation">,</span> <span class="token string">'handler'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>Custom patterns for route placeholders <code>cannot use capturing groups</code>. For example <code>{lang:(en|de)}</code> is not a valid placeholder, because <code>()</code> is a capturing group. Instead you can use either <code>{lang:en|de}</code> or <code>{lang:(?:en|de)}</code>.</p><p>Furthermore parts of the route enclosed in <code>[...]</code> are considered optional, so that <code>/foo[bar]</code> will match both <code>/foo</code> and <code>/foobar</code>. Optional parts are only supported in a <code>trailing position</code>, not in the middle of a route.</p><p><img src="/media/15956423117442/Screen%20Shot%202020-08-19%20at%201.19.42%20PM.png" alt="Screen Shot 2020-08-19 at 1.19.42 PM"></p><h2 id="è·¯ç”±å­—ç¬¦ä¸²è§£æ"><a href="#è·¯ç”±å­—ç¬¦ä¸²è§£æ" class="headerlink" title="è·¯ç”±å­—ç¬¦ä¸²è§£æ"></a>è·¯ç”±å­—ç¬¦ä¸²è§£æ</h2><ol><li><code>/abc/</code>ä¸<code>/abc/</code>æ˜¯ä¸ç›¸åŒçš„ä¸¤ä¸ªè·¯ç”±ã€‚å¦‚æœè‡ªå®šä¹‰äº†<code>/abc/</code>ï¼Œå¦‚æœè®¿é—®<code>/abc</code>åˆ™ä¼šå‡ºç°<code>404é”™è¯¯</code>ã€‚å¯ä»¥åœ¨è·¯ç”±å®šä¹‰æ—¶ï¼Œåœ¨ç»“å°¾æ·»åŠ <code>[/]</code>å¯é€‰è·¯ç”±ç‰‡æ®µã€‚</li><li>è·¯ç”±å­ç‰‡æ®µä¸ºå‚æ•°æ•è·æ—¶ï¼Œè¿™ä¸ªå­ç‰‡æ®µå¯¹åº”çš„ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œä¸åŒ…å«å‰åçš„<code>/</code>,å‰åçš„åæ–œçº¿ï¼Œä¼šä¾é™„äºä¸€ä¸ªç´§è´´ç€çš„å­—é¢é‡çš„è·¯ç”±å­ç‰‡æ®µï¼š</li><li>å¦‚æœç´§è´´ç€çš„è¿˜æ˜¯ä¸€ä¸ªå‚æ•°æ•è·å­ç‰‡æ®µï¼Œåˆ™(<code>/</code>)æœ¬èº«å°±æ˜¯ä¸€ä¸ªè·¯ç”±å­ç‰‡æ®µï¼Œå•ç‹¬å ä¸€ä¸ªç´¢å¼•ï¼Œå…¶å€¼ä¸ºå­—ç¬¦ä¸²<code>/</code>ã€‚</li><li>æ•è·å‚æ•°å­ç‰‡æ®µå‰åçš„éæ•è·è·¯ç”±ç‰‡æ®µï¼Œéƒ½ä¼šè§£æä¸º<code>æ•°å­—ç´¢å¼•=&gt;å­—ç¬¦ä¸²</code>ã€‚</li></ol><p>å½“è·¯ç”±ä¸­åŒ…æ‹¬æ•è·å‚æ•°çš„è¯­æ³•ï¼š</p><p><img src="/media/15956423117442/Screen%20Shot%202020-08-19%20at%201.19.42%20PM.png" alt="Screen Shot 2020-08-19 at 1.19.42 PM"></p><p>å¦‚è·¯ç”±ï¼š<code>/user/{id:\d+}</code><br><code>routeData</code>çš„ç¬¬ä¸€ç»´æˆå‘˜ã€ç´¢å¼•0çš„æ•°ç»„ã€‘ï¼Œçš„å­å…ƒç´ ä¸ºè·¯ç”±å­—ç¬¦ä¸²è§£æè¿‡çš„ç»“æœã€‚</p><p>ç´¢å¼•<code>0</code>å¯¹åº”çš„ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œä»è·¯ç”±å¼€å§‹ä¸€ç›´åˆ°å‚æ•°æ•è·å®šä¹‰èµ·å§‹ç‚¹ã€‚ç´¢å¼•<code>1</code>å¯¹åº”çš„ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œå…¶ç´¢å¼•<code>0</code>ä¸ºæ•è·å‚æ•°çš„åç§°ï¼Œç´¢å¼•<code>1</code>ä¸ºå¯¹åº”çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚</p><p>è·¯ç”±ï¼š<code>/email/verify/{id}/{hash}</code><br>åªè®¾ç½®äº†æ•è·å‚æ•°çš„åç§°ï¼Œæ²¡æœ‰å¯¹åº”çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå…¶é»˜è®¤æ­£åˆ™è¡¨è¾¾å¼ä¸ºï¼š<code>[^/]+</code>ã€‚</p><p><img src="/media/15956423117442/Screen%20Shot%202020-08-19%20at%201.25.25%20PM.png" alt="Screen Shot 2020-08-19 at 1.25.25 PM"></p><p>å½“ä¸åŒ…å«æ•è·å‚æ•°æ—¶ï¼Œè·¯ç”±è§£ææ•°ç»„çš„<code>0</code>ç´¢å¼•å¯¹åº”çš„ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œè€Œéå­—ç¬¦ä¸²ã€‚<br>å¦‚è·¯ç”±ï¼š<code>/abc/</code><br><img src="/media/15956423117442/Screen%20Shot%202020-08-19%20at%201.27.16%20PM.png" alt="Screen Shot 2020-08-19 at 1.27.16 PM"></p><p>å…¶<code>routeData</code>çš„å­æ•°ç»„çš„<code>0</code>ç´¢å¼•å€¼ä¸ºä¸€ä¸ªæ•°ç»„è€Œéå­—ç¬¦ä¸²ã€‚</p><ol><li>è·¯ç”±å­ç‰‡æ®µä¸ºå‚æ•°æ•è·æ—¶ï¼Œè¿™ä¸ªå­ç‰‡æ®µå¯¹åº”çš„ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œä¸åŒ…å«å‰åçš„<code>/</code>,å‰åçš„åæ–œçº¿ï¼Œä¼šä¾é™„äºä¸€ä¸ªç´§è´´ç€çš„å­—é¢é‡çš„è·¯ç”±å­ç‰‡æ®µï¼š</li><li>å¦‚æœç´§è´´ç€çš„è¿˜æ˜¯ä¸€ä¸ªå‚æ•°æ•è·å­ç‰‡æ®µï¼Œåˆ™(<code>/</code>)æœ¬èº«å°±æ˜¯ä¸€ä¸ªè·¯ç”±å­ç‰‡æ®µï¼Œå•ç‹¬å ä¸€ä¸ªç´¢å¼•ï¼Œå…¶å€¼ä¸ºå­—ç¬¦ä¸²<code>/</code>ã€‚</li><li>æ•è·å‚æ•°å­ç‰‡æ®µå‰åçš„éæ•è·è·¯ç”±ç‰‡æ®µï¼Œéƒ½ä¼šè§£æä¸º<code>æ•°å­—ç´¢å¼•=&gt;å­—ç¬¦ä¸²</code>ã€‚</li></ol><p>å¦‚è·¯ç”±ï¼š<code>/email/verify/{id}/{hash}</code> </p><hr><ul><li><code>/email/verify/</code>å› ä¸ºå…¶åä¸ºå‚æ•°æ•è·ç‰‡æ®µï¼Œæ‰€ä»¥å…¶è§£æä¸ºå­—ç¬¦ä¸²ã€‚</li><li>å› ä¸º<code>{id}</code>ä¸ºå‚æ•°æ•è·ç‰‡æ®µï¼Œæ‰€ä»¥å…¶è§£æä¸ºæ•°ç»„ã€‚</li><li><code>/</code> å› ä¸ºå…¶å‰åéƒ½æ˜¯å‚æ•°æ•è·ç‰‡æ®µï¼Œæ‰€ä»¥å…¶è§£æä¸ºå­—ç¬¦ä¸²ã€‚</li></ul><hr><pre class="line-numbers language-php"><code class="language-php"> <span class="token string">"email.verify"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">array</span><span class="token punctuation">:</span><span class="token number">5</span> <span class="token punctuation">[</span>    <span class="token string">"server"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"http"</span>    <span class="token string">"route"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"/email/verify/{id}/{hash}"</span>    <span class="token string">"method"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">array</span><span class="token punctuation">:</span><span class="token number">1</span> <span class="token punctuation">[</span>      <span class="token number">0</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"GET"</span>    <span class="token punctuation">]</span>    <span class="token string">"routeData"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">array</span><span class="token punctuation">:</span><span class="token number">1</span> <span class="token punctuation">[</span>      <span class="token number">0</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">array</span><span class="token punctuation">:</span><span class="token number">4</span> <span class="token punctuation">[</span>        <span class="token number">0</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"/email/verify/"</span>        <span class="token number">1</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">array</span><span class="token punctuation">:</span><span class="token number">2</span> <span class="token punctuation">[</span>          <span class="token number">0</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"id"</span>          <span class="token number">1</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"[^/]+"</span>        <span class="token punctuation">]</span>        <span class="token number">2</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"/"</span>        <span class="token number">3</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">array</span><span class="token punctuation">:</span><span class="token number">2</span> <span class="token punctuation">[</span>          <span class="token number">0</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"hash"</span>          <span class="token number">1</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"[^/]+"</span>        <span class="token punctuation">]</span>      <span class="token punctuation">]</span>    <span class="token punctuation">]</span>    <span class="token string">"option"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">array</span><span class="token punctuation">:</span><span class="token number">1</span> <span class="token punctuation">[</span>      <span class="token string">"name"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"email.verify"</span>    <span class="token punctuation">]</span>  <span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><p>è·¯ç”± <code>/abc/{id:\d+}/def/</code></p><ul><li><code>/abc/</code>ä¹‹åä¸ºå‚æ•°æ•è·ç‰‡æ®µï¼Œ<strong>å…¶å‰åéå‚æ•°æ•è·ç‰‡æ®µéƒ½è§£æä¸ºå­—ç¬¦ä¸²</strong>ã€‚</li></ul><pre class="line-numbers language-php"><code class="language-php"><span class="token string">"endWithSlash"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">array</span><span class="token punctuation">:</span><span class="token number">5</span> <span class="token punctuation">[</span>    <span class="token string">"server"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"http"</span>    <span class="token string">"route"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"/abc/{id:\d+}/def/"</span>    <span class="token string">"method"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">array</span><span class="token punctuation">:</span><span class="token number">1</span> <span class="token punctuation">[</span>      <span class="token number">0</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"GET"</span>    <span class="token punctuation">]</span>    <span class="token string">"routeData"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">array</span><span class="token punctuation">:</span><span class="token number">1</span> <span class="token punctuation">[</span>      <span class="token number">0</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">array</span><span class="token punctuation">:</span><span class="token number">3</span> <span class="token punctuation">[</span>        <span class="token number">0</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"/abc/"</span>        <span class="token number">1</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">array</span><span class="token punctuation">:</span><span class="token number">2</span> <span class="token punctuation">[</span>          <span class="token number">0</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"id"</span>          <span class="token number">1</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"\d+"</span>        <span class="token punctuation">]</span>        <span class="token number">2</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"/def/"</span>      <span class="token punctuation">]</span>    <span class="token punctuation">]</span>    <span class="token string">"option"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">array</span><span class="token punctuation">:</span><span class="token number">1</span> <span class="token punctuation">[</span>      <span class="token string">"name"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"endWithSlash"</span>    <span class="token punctuation">]</span>  <span class="token punctuation">]</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è·¯ç”±åˆ†å‘å™¨ å’Œ è·¯ç”±æ•°æ®æ”¶é›†å™¨éƒ½æ˜¯ç”± <code>\Hyperf\HttpServer\Router\DispatcherFactory</code>ç±»æ¥åˆå§‹åŒ–çš„ï¼Œå› ä¸º<code>Hyperf</code>å¯ä»¥åˆ›å»ºå¤šä¸ªæœåŠ¡å®ä¾‹ï¼Œæ‰€ä»¥æ¯ä¸ªæœåŠ¡å¯ä»¥æœ‰å„è‡ªçš„è·¯ç”±åˆ†å‘å™¨å’Œè·¯ç”±æ•°æ®æ”¶é›†å™¨ã€‚</p><pre class="line-numbers language-php"><code class="language-php"><span class="token variable">$routers</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token string">'http'</span><span class="token operator">=</span><span class="token operator">></span>Hyperf\<span class="token package">Http<span class="token punctuation">\</span>Server<span class="token punctuation">\</span>Router<span class="token punctuation">\</span>RouterCollector</span>å®ä¾‹<span class="token punctuation">]</span><span class="token variable">$dispatchers</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token string">'http'</span><span class="token operator">=</span><span class="token operator">></span>FastRoute\<span class="token package">Dispatcher<span class="token punctuation">\</span>GroupCountBased</span>å®ä¾‹<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è·¯ç”±æ”¶é›†å™¨ç»“åˆä¿å­˜åœ¨<code>$routes</code>å±æ€§é‡Œ,æ¯”<code>$dispatchers</code>å…ˆåˆ›å»ºã€‚åœ¨æ„é€ DispatcherFactoryæ—¶åˆ›å»ºã€‚<br>è·¯ç”±åˆ†å‘å™¨ä¿å­˜åœ¨<code>$dispatchers</code>å±æ€§é‡Œ,åœ¨åˆå§‹åŒ–æ ¸å¿ƒè·¯ç”±ä¸­é—´ä»¶æ—¶ï¼Œè°ƒç”¨<code>getDispatcher($naem)</code>æ—¶åˆ›å»ºã€‚</p><p><img src="/media/15956423117442/15959553595176.jpg" alt="-w565"><br>å®ä¾‹åŒ–å¹¶è°ƒç”¨<code>getDispatcher($ServerName)</code>ä¹‹åçš„å¯¹è±¡<br><img src="/media/15956423117442/Screen%20Shot%202020-07-29%20at%201.21.41%20AM.png" alt="-w520"></p><p><code>/user/{id:\d+}</code><br><code>/usr/1</code><br><img src="/media/15956423117442/15978224361122.jpg" alt="-w455"></p><p>ä¸‹é¢è¿™ä¸ª<code>1={array}[1]</code>å¯¹åº”<code>[0=&gt;'id']</code>;å¯ä»¥ä¸æ­£åˆ™è¡¨è¾¾å¼ç›¸ç»“åˆï¼Œè·å¾—<code>handler</code>å›è°ƒä¸­çš„å‚æ•°æ•°ç»„ã€‚å³ç”¨æ­£åˆ™è¡¨è¾¾å¼å»åŒ¹é…è¯·æ±‚<code>uri</code>ç„¶åï¼Œè·å¾—æ•è·çš„å‚æ•°ã€‚ç„¶åå’Œå‚æ•°åç›¸ç»“åˆï¼Œæœ€ç»ˆå¯ä»¥è·å¾—ä»¥ä¸‹å‚æ•°æ•°ç»„<code>['id'=&gt;1]</code>ã€‚</p><h2 id="è·¯ç”±é…ç½®æ¥æº"><a href="#è·¯ç”±é…ç½®æ¥æº" class="headerlink" title="è·¯ç”±é…ç½®æ¥æº"></a>è·¯ç”±é…ç½®æ¥æº</h2><h3 id="é…ç½®æ–‡ä»¶config-routes-php"><a href="#é…ç½®æ–‡ä»¶config-routes-php" class="headerlink" title="é…ç½®æ–‡ä»¶config/routes.php"></a>é…ç½®æ–‡ä»¶<code>config/routes.php</code></h3><p>é…ç½®æ–‡ä»¶ç”±<code>Hyperf\HttpServer\Router\DispatchFactory</code><br><code>  protected $routes = [BASE_PATH . '/config/routes.php'];</code>å±æ€§å®šä¹‰è·¯å¾„ã€‚</p><p><em>Hyperf\HttpServer\Router\DispatcherFactory</em>@<code>__construct()</code></p><pre class="line-numbers language-php"><code class="language-php"> <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">initAnnotationRoute</span><span class="token punctuation">(</span>AnnotationCollector<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ä½¿ç”¨æ³¨è§£æ³¨å†Œ</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">initConfigRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è¯»å–é…ç½®æ–‡ä»¶æ³¨å†Œ</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è§£ææ§åˆ¶å™¨ç±»æ³¨è§£æ¥æ·»åŠ è·¯ç”±"><a href="#è§£ææ§åˆ¶å™¨ç±»æ³¨è§£æ¥æ·»åŠ è·¯ç”±" class="headerlink" title="è§£ææ§åˆ¶å™¨ç±»æ³¨è§£æ¥æ·»åŠ è·¯ç”±"></a>è§£ææ§åˆ¶å™¨ç±»æ³¨è§£æ¥æ·»åŠ è·¯ç”±</h3><h2 id="æ·»åŠ è·¯ç”±çš„è°ƒç”¨è·¯çº¿"><a href="#æ·»åŠ è·¯ç”±çš„è°ƒç”¨è·¯çº¿" class="headerlink" title="æ·»åŠ è·¯ç”±çš„è°ƒç”¨è·¯çº¿"></a>æ·»åŠ è·¯ç”±çš„è°ƒç”¨è·¯çº¿</h2><ul><li>é€šè¿‡é…ç½®æ–‡ä»¶æ·»åŠ è·¯ç”±,è°ƒç”¨è·¯çº¿</li></ul><pre class="line-numbers language-php"><code class="language-php">RegexBasedAbstract<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">29</span><span class="token punctuation">,</span> FastRoute\<span class="token package">DataGenerator<span class="token punctuation">\</span>GroupCountBased</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>RouteCollector<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">72</span><span class="token punctuation">,</span> Hyperf\<span class="token package">HttpServer<span class="token punctuation">\</span>Router<span class="token punctuation">\</span>RouteCollector</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>Router<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">,</span> Hyperf\<span class="token package">HttpServer<span class="token punctuation">\</span>Router<span class="token punctuation">\</span>Router</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">__callStatic</span><span class="token punctuation">(</span><span class="token punctuation">)</span>routes<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">15</span><span class="token punctuation">,</span> Hyperf\<span class="token package">HttpServer<span class="token punctuation">\</span>Router<span class="token punctuation">\</span>Router</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">addRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>routes<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token punctuation">)</span>DispatcherFactory<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">70</span><span class="token punctuation">,</span> Hyperf\<span class="token package">HttpServer<span class="token punctuation">\</span>Router<span class="token punctuation">\</span>DispatcherFactory</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">initConfigRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>DispatcherFactory<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">52</span><span class="token punctuation">,</span> Hyperf\<span class="token package">HttpServer<span class="token punctuation">\</span>Router<span class="token punctuation">\</span>DispatcherFactory</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è§£ææ§åˆ¶å™¨ç±»æ³¨è§£æ¥æ·»åŠ è·¯ç”±ï¼Œè°ƒç”¨è·¯çº¿</li></ul><pre class="line-numbers language-php"><code class="language-php">RegexBasedAbstract<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">85</span><span class="token punctuation">,</span> FastRoute\<span class="token package">DataGenerator<span class="token punctuation">\</span>GroupCountBased</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addStaticRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>RegexBasedAbstract<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">30</span><span class="token punctuation">,</span> FastRoute\<span class="token package">DataGenerator<span class="token punctuation">\</span>GroupCountBased</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>RouteCollector<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">72</span><span class="token punctuation">,</span> Hyperf\<span class="token package">HttpServer<span class="token punctuation">\</span>Router<span class="token punctuation">\</span>RouteCollector</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>DispatcherFactory<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">185</span><span class="token punctuation">,</span> Hyperf\<span class="token package">HttpServer<span class="token punctuation">\</span>Router<span class="token punctuation">\</span>DispatcherFactory</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">handleController</span><span class="token punctuation">(</span><span class="token punctuation">)</span>DispatcherFactory<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">99</span><span class="token punctuation">,</span> Hyperf\<span class="token package">HttpServer<span class="token punctuation">\</span>Router<span class="token punctuation">\</span>DispatcherFactory</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">initAnnotationRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><ul><li>ä»å¯åŠ¨åˆ°<code>Hyperf\HttpServer\Router\DispatcherFactory</code>çš„åˆå§‹åŒ–ã€‚</li></ul><pre class="line-numbers language-php"><code class="language-php">DispatcherFactory<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">51</span><span class="token punctuation">,</span> Hyperf\<span class="token package">HttpServer<span class="token punctuation">\</span>Router<span class="token punctuation">\</span>DispatcherFactory</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ObjectResolver<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">99</span><span class="token punctuation">,</span> Hyperf\<span class="token package">Di<span class="token punctuation">\</span>Resolver<span class="token punctuation">\</span>ObjectResolver</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">createInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ObjectResolver<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">66</span><span class="token punctuation">,</span> Hyperf\<span class="token package">Di<span class="token punctuation">\</span>Resolver<span class="token punctuation">\</span>ObjectResolver</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ResolverDispatcher<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">59</span><span class="token punctuation">,</span> Hyperf\<span class="token package">Di<span class="token punctuation">\</span>Resolver<span class="token punctuation">\</span>ResolverDispatcher</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>Container<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">182</span><span class="token punctuation">,</span> Hyperf\<span class="token package">Di<span class="token punctuation">\</span>Container</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">resolveDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>Container<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">82</span><span class="token punctuation">,</span> Hyperf\<span class="token package">Di<span class="token punctuation">\</span>Container</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">)</span>Container<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">117</span><span class="token punctuation">,</span> Hyperf\<span class="token package">Di<span class="token punctuation">\</span>Container</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>CoreMiddleware<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">138</span><span class="token punctuation">,</span> Hyperf\<span class="token package">HttpServer<span class="token punctuation">\</span>CoreMiddleware</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">createDispatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span>CoreMiddleware<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">71</span><span class="token punctuation">,</span> Hyperf\<span class="token package">HttpServer<span class="token punctuation">\</span>CoreMiddleware</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ObjectResolver<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">99</span><span class="token punctuation">,</span> Hyperf\<span class="token package">Di<span class="token punctuation">\</span>Resolver<span class="token punctuation">\</span>ObjectResolver</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">createInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ObjectResolver<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">66</span><span class="token punctuation">,</span> Hyperf\<span class="token package">Di<span class="token punctuation">\</span>Resolver<span class="token punctuation">\</span>ObjectResolver</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ResolverDispatcher<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">59</span><span class="token punctuation">,</span> Hyperf\<span class="token package">Di<span class="token punctuation">\</span>Resolver<span class="token punctuation">\</span>ResolverDispatcher</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>Container<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">182</span><span class="token punctuation">,</span> Hyperf\<span class="token package">Di<span class="token punctuation">\</span>Container</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">resolveDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>Container<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">82</span><span class="token punctuation">,</span> Hyperf\<span class="token package">Di<span class="token punctuation">\</span>Container</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">)</span>Functions<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">413</span><span class="token punctuation">,</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">)</span>Server<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">164</span><span class="token punctuation">,</span> Hyperf\<span class="token package">HttpServer<span class="token punctuation">\</span>Server</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">createCoreMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span>Server<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">94</span><span class="token punctuation">,</span> Hyperf\<span class="token package">HttpServer<span class="token punctuation">\</span>Server</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">initCoreMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span>Server<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">205</span><span class="token punctuation">,</span> Hyperf\<span class="token package">Server<span class="token punctuation">\</span>Server</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">registerSwooleEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span>Server<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">102</span><span class="token punctuation">,</span> Hyperf\<span class="token package">Server<span class="token punctuation">\</span>Server</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">initServers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>Server<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">72</span><span class="token punctuation">,</span> Hyperf\<span class="token package">Server<span class="token punctuation">\</span>Server</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ServerFactory<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">56</span><span class="token punctuation">,</span> Hyperf\<span class="token package">Server<span class="token punctuation">\</span>ServerFactory</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>StartServer<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">52</span><span class="token punctuation">,</span> Hyperf\<span class="token package">Server<span class="token punctuation">\</span>Command<span class="token punctuation">\</span>StartServer</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>Command<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">258</span><span class="token punctuation">,</span> Hyperf\<span class="token package">Server<span class="token punctuation">\</span>Command<span class="token punctuation">\</span>StartServer</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>Application<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">929</span><span class="token punctuation">,</span> Symfony\<span class="token package">Component<span class="token punctuation">\</span>Console<span class="token punctuation">\</span>Application</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">doRunCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span>Application<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">264</span><span class="token punctuation">,</span> Symfony\<span class="token package">Component<span class="token punctuation">\</span>Console<span class="token punctuation">\</span>Application</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">doRun</span><span class="token punctuation">(</span><span class="token punctuation">)</span>Application<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">140</span><span class="token punctuation">,</span> Symfony\<span class="token package">Component<span class="token punctuation">\</span>Console<span class="token punctuation">\</span>Application</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>hyperf<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">34</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>closure<span class="token punctuation">:</span><span class="token operator">/</span>home<span class="token operator">/</span>vagrant<span class="token operator">/</span>code<span class="token operator">/</span>hyperf<span class="token operator">/</span>hyperf<span class="token operator">-</span>skeleton<span class="token operator">/</span>bin<span class="token operator">/</span>hyperf<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">15</span><span class="token operator">-</span><span class="token number">35</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>hyperf<span class="token punctuation">.</span>php<span class="token punctuation">:</span><span class="token number">35</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>main<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è·¯ç”±è®¾å®š"><a href="#è·¯ç”±è®¾å®š" class="headerlink" title="è·¯ç”±è®¾å®š"></a>è·¯ç”±è®¾å®š</h2><h3 id="é…ç½®æ–‡ä»¶é™æ€è·¯ç”±æ·»åŠ "><a href="#é…ç½®æ–‡ä»¶é™æ€è·¯ç”±æ·»åŠ " class="headerlink" title="é…ç½®æ–‡ä»¶é™æ€è·¯ç”±æ·»åŠ "></a>é…ç½®æ–‡ä»¶é™æ€è·¯ç”±æ·»åŠ </h3><ul><li>ä½¿ç”¨å­—ç¬¦ä¸²æ•è·urlå‚æ•°</li></ul><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">// Matches /user/foobar, but not /user/foo/bar</span>Router<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">addRoute</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'/user/{name}'</span><span class="token punctuation">,</span> <span class="token string">'handler'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>å‚æ•°åä¸º`name`<span class="token punctuation">,</span>å€¼ä¸ºuriä¸­`<span class="token operator">/</span>user<span class="token operator">/</span>`åé¢çš„å€¼<span class="token comment" spellcheck="true">// Matches /user/foo/bar as well</span><span class="token variable">$r</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addRoute</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'/user/{name:.+}'</span><span class="token punctuation">,</span> <span class="token string">'handler'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// Matches /user/42, but not /user/xyz</span><span class="token variable">$r</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addRoute</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'/user/{id:\d+}'</span><span class="token punctuation">,</span> <span class="token string">'handler'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h4><p>åŠ¨æ€è·¯ç”±å¤„ç†</p><p>routeå®šä¹‰ ï¼š<code>Router::addRoute(['GET', 'POST', 'HEAD'], '/user/{id:\d+}', 'App\Controller\IndexController@index'); </code><br>url: <code>http://homestead.test:9501/user/123</code></p><p><em>\FastRoute\Dispatcher\GroupCountBased</em>::<code>dispatchVariableRoute</code></p><h4 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h4><p><code>$routeData Array</code></p><p><img src="/media/15956423117442/Screen%20Shot%202020-07-28%20at%207.26.58%20AM.png" alt="Screen Shot 2020-07-28 at 7.26.58 AM-w455"></p><p><code>$uri String</code><br><code>$uri=/user/123</code></p><h3 id="é…ç½®æ–‡ä»¶åŠ¨æ€è·¯ç”±æ·»åŠ "><a href="#é…ç½®æ–‡ä»¶åŠ¨æ€è·¯ç”±æ·»åŠ " class="headerlink" title="é…ç½®æ–‡ä»¶åŠ¨æ€è·¯ç”±æ·»åŠ "></a>é…ç½®æ–‡ä»¶åŠ¨æ€è·¯ç”±æ·»åŠ </h3><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">use</span> <span class="token package">Hyperf<span class="token punctuation">\</span>HttpServer<span class="token punctuation">\</span>Router<span class="token punctuation">\</span>Router</span><span class="token punctuation">;</span>Router<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/get'</span><span class="token punctuation">,</span> <span class="token string">'App\Controller\IndexController::get'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Router<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/get'</span><span class="token punctuation">,</span> <span class="token string">'App\Controller\IndexController@get'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Router<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/get'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>\<span class="token package">App<span class="token punctuation">\</span>Controller<span class="token punctuation">\</span>IndexController</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">'get'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Router<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">addRoute</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'HEAD'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'/multi'</span><span class="token punctuation">,</span> <span class="token string">'App\Controller\IndexController::multi'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Router<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">addRoute</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'HEAD'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'/multi'</span><span class="token punctuation">,</span> <span class="token string">'App\Controller\IndexController@multi'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Router<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">addRoute</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'HEAD'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'/multi'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>\<span class="token package">App<span class="token punctuation">\</span>Controller<span class="token punctuation">\</span>IndexController</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">'multi'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><pre class="line-numbers language-php"><code class="language-php"> <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">initCoreMiddleware</span><span class="token punctuation">(</span>string <span class="token variable">$serverName</span><span class="token punctuation">)</span><span class="token punctuation">:</span> void    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">serverName</span> <span class="token operator">=</span> <span class="token variable">$serverName</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">coreMiddleware</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">createCoreMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">routerDispatcher</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">createDispatcher</span><span class="token punctuation">(</span><span class="token variable">$serverName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$config</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">container</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span>ConfigInterface<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">middlewares</span> <span class="token operator">=</span> <span class="token variable">$config</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'middlewares.'</span> <span class="token punctuation">.</span> <span class="token variable">$serverName</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">exceptionHandlers</span> <span class="token operator">=</span> <span class="token variable">$config</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'exceptions.handler.'</span> <span class="token punctuation">.</span> <span class="token variable">$serverName</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getDefaultExceptionHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä¿å­˜è·¯ç”±çš„ç±»ã€è·¯ç”±æ”¶é›†å™¨çš„ä»£ç†ã€‘"><a href="#ä¿å­˜è·¯ç”±çš„ç±»ã€è·¯ç”±æ”¶é›†å™¨çš„ä»£ç†ã€‘" class="headerlink" title="ä¿å­˜è·¯ç”±çš„ç±»ã€è·¯ç”±æ”¶é›†å™¨çš„ä»£ç†ã€‘"></a>ä¿å­˜è·¯ç”±çš„ç±»ã€è·¯ç”±æ”¶é›†å™¨çš„ä»£ç†ã€‘</h3><p><code>\FastRoute\DataGenerator\GroupCountBased</code></p><p>æ­¤ç±»<code>UML</code>å›¾<br><img src="/media/15956423117442/Screen%20Shot%202020-07-28%20at%2010.24.14%20AM.png" alt="-w417"></p><h4 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h4><h5 id="staticRoutes"><a href="#staticRoutes" class="headerlink" title="$staticRoutes"></a>$staticRoutes</h5><p>ä¿å­˜é™æ€è·¯ç”±çš„æ•°ç»„</p><pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">/** @var mixed[][] */</span>    <span class="token keyword">protected</span> <span class="token variable">$staticRoutes</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h5 id="methodToRegexToRoutesMap"><a href="#methodToRegexToRoutesMap" class="headerlink" title="$methodToRegexToRoutesMap"></a>$methodToRegexToRoutesMap</h5><p>ä¿å­˜åŠ¨æ€è·¯ç”±çš„æ•°ç»„</p><pre class="line-numbers language-php"><code class="language-php">    <span class="token comment" spellcheck="true">/** @var Route[][] */</span>    <span class="token keyword">protected</span> <span class="token variable">$methodToRegexToRoutesMap</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h4><h5 id="addRoute"><a href="#addRoute" class="headerlink" title="addRoute"></a>addRoute</h5><p>åœ¨é…ç½®æ–‡ä»¶<code>routes</code>ä¸­è°ƒç”¨<code>Router::addRoute</code>æ–¹æ³•ï¼Œç„¶åè½¬å‘åˆ°å…¶<code>__callStatic</code>æ–¹æ³•ï¼Œå…¶è°ƒç”¨å…¶é™æ€å±æ€§<code>$factory</code>[<code>\Hyperf\HttpServer\Router\DispatcherFactory</code>]å®ä¾‹çš„<code>getRouter</code>è¿”å›çš„[<code>Hyperf\HttpServer\Router\RouterCollector</code>]å®ä¾‹æ¥å¤„ç†<code>addRoute</code>çš„è°ƒç”¨ã€‚å³<code>Hyperf\HttpServer\Router\RouterCollector</code>ä¸º<code>Hyperf\HttpServer\Router\Router</code>çš„ä»£ç†ã€‚</p><p><code>RouterCollector</code>æ”¶åˆ°å‚æ•°åï¼Œåœ¨æ ¼å¼åŒ–ï¼Œäº¤ç»™å…¶<code>dataGenerator </code>å±æ€§ä¿å­˜çš„<code>\FastRoute\DataGenerator\GroupCountBased</code>å®ä¾‹çš„<a href="#addroute">addroute</a>æ–¹æ³•å¤„ç†ã€‚<code>GroupCountBased</code>æœ€ç»ˆæ ¹æ®æ•°æ®ç±»å‹åˆ†åˆ«ä¿å­˜åˆ°å…¶<code>$staticRoute</code>å’Œ<code>$methodToRegexToRoutesMap</code>å±æ€§ã€‚</p><p>RouterCollectorç±»<code>UML</code>å›¾ï¼š<br><img src="/media/15956423117442/Screen%20Shot%202020-07-28%20at%2010.35.08%20AM.png" alt="-w373"></p><h2 id="ä½¿ç”¨è·¯ç”±"><a href="#ä½¿ç”¨è·¯ç”±" class="headerlink" title="ä½¿ç”¨è·¯ç”±"></a>ä½¿ç”¨è·¯ç”±</h2><h3 id="æœåŠ¡å¯åŠ¨å‰èµ‹å€¼ç»™æ ¸å¿ƒä¸­é—´ä»¶"><a href="#æœåŠ¡å¯åŠ¨å‰èµ‹å€¼ç»™æ ¸å¿ƒä¸­é—´ä»¶" class="headerlink" title="æœåŠ¡å¯åŠ¨å‰èµ‹å€¼ç»™æ ¸å¿ƒä¸­é—´ä»¶"></a>æœåŠ¡å¯åŠ¨å‰èµ‹å€¼ç»™æ ¸å¿ƒä¸­é—´ä»¶</h3><p><img src="/media/15956423117442/Screen%20Shot%202020-07-29%20at%202.46.29%20AM.png" alt="-w413"></p><p><em>\Hyperf\HttpServer\Server</em>::<code>initCoreMiddleware</code></p><pre class="line-numbers language-php"><code class="language-php"> <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">initCoreMiddleware</span><span class="token punctuation">(</span>string <span class="token variable">$serverName</span><span class="token punctuation">)</span><span class="token punctuation">:</span> void    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">serverName</span> <span class="token operator">=</span> <span class="token variable">$serverName</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">coreMiddleware</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">createCoreMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è·å–</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">routerDispatcher</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">createDispatcher</span><span class="token punctuation">(</span><span class="token variable">$serverName</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><em>\Hyperf\HttpServer\CoreMiddleware</em>::<code>__construct</code></p><pre class="line-numbers language-php"><code class="language-php">  <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>ContainerInterface <span class="token variable">$container</span><span class="token punctuation">,</span> string <span class="token variable">$serverName</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">container</span> <span class="token operator">=</span> <span class="token variable">$container</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">dispatcher</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">createDispatcher</span><span class="token punctuation">(</span><span class="token variable">$serverName</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><em>\Hyperf\HttpServer\CoreMiddleware</em>::<code>createDispatcher</code></p><pre class="line-numbers language-php"><code class="language-php">  <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">createDispatcher</span><span class="token punctuation">(</span>string <span class="token variable">$serverName</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Dispatcher    <span class="token punctuation">{</span>        <span class="token variable">$factory</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">container</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span>DispatcherFactory<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æ­¤æ–¹æ³•ç¬¬ä¸€æ¬¡åˆ›å»º`DispatcherFactory`å®ä¾‹ã€‚</span>        <span class="token keyword">return</span> <span class="token variable">$factory</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getDispatcher</span><span class="token punctuation">(</span><span class="token variable">$serverName</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æ­¤æ–¹æ³•ç¬¬ä¸€æ¬¡åˆ›å»º`FastRoute\Dispatcher\GroupCountBased`å®ä¾‹ã€‚</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><ul><li>åœ¨åˆå§‹åŒ–è·¯ç”±ä¸­é—´ä»¶æ—¶ï¼Œå°†è·¯ç”±åˆ†å‘å™¨èµ‹å€¼ç»™<code>$dispatcher</code>å±æ€§ã€‚è·¯ç”±ä¸­é—´ä»¶é€šè¿‡<code>servername</code>è°ƒç”¨<code>DispatcherFactory</code>å®ä¾‹çš„<code>getDispatcher($servername)</code>æ–¹æ³•ã€‚</li></ul><h3 id="è¯·æ±‚é˜¶æ®µä½¿ç”¨è·¯ç”±éæ³•å™¨æ¥éªŒè¯è·¯ç”±"><a href="#è¯·æ±‚é˜¶æ®µä½¿ç”¨è·¯ç”±éæ³•å™¨æ¥éªŒè¯è·¯ç”±" class="headerlink" title="è¯·æ±‚é˜¶æ®µä½¿ç”¨è·¯ç”±éæ³•å™¨æ¥éªŒè¯è·¯ç”±"></a>è¯·æ±‚é˜¶æ®µä½¿ç”¨è·¯ç”±éæ³•å™¨æ¥éªŒè¯è·¯ç”±</h3><ul><li>åœ¨è¯·æ±‚å¤„ç†é˜¶æ®µï¼Œ<code>noRequest</code>äº‹ä»¶ç»‘å®šçš„å›è°ƒä¸­,è°ƒç”¨è·¯ç”±ä¸­é—´ä»¶å®ä¾‹çš„<code>$dispatcher</code>å±æ€§ä¸Šçš„<code>dispatch</code>æ–¹æ³•ã€‚</li></ul><pre class="line-numbers language-php"><code class="language-php"> <span class="token variable">$psr7Request</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">coreMiddleware</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token variable">$psr7Request</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ä¼šè½¬å‘ç»™coreMiddlewareå®ä¾‹çš„$dispatcherå±æ€§ä¸Šçš„dispatchæ–¹æ³•</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/media/15956423117442/Screen%20Shot%202020-07-29%20at%202.43.35%20AM.png" alt="-w319"></p><p><em>\Hyperf\HttpServer\CoreMiddleware</em>::<code>dispatch</code></p><pre class="line-numbers language-php"><code class="language-php"> <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>ServerRequestInterface <span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">:</span> ServerRequestInterface    <span class="token punctuation">{</span>        <span class="token variable">$routes</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">dispatcher</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getUri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$dispatched</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dispatched</span><span class="token punctuation">(</span><span class="token variable">$routes</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> Context<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">set</span><span class="token punctuation">(</span>ServerRequestInterface<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">withAttribute</span><span class="token punctuation">(</span>Dispatched<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token variable">$dispatched</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><pre><code>/**     * Dispatches against the provided HTTP method verb and URI.     *     * @param array $array with one of the following formats:     *     *     [Dispatcher::NOT_FOUND]     *     [Dispatcher::METHOD_NOT_ALLOWED, ['GET', 'OTHER_ALLOWED_METHODS']]     *     [Dispatcher::FOUND, $handler, ['varName' =&gt; 'value', ...]]     */</code></pre><h3 id="Dispatchedç»“æ„å›¾"><a href="#Dispatchedç»“æ„å›¾" class="headerlink" title="Dispatchedç»“æ„å›¾"></a>Dispatchedç»“æ„å›¾</h3><p><img src="/media/15956423117442/Screen%20Shot%202020-07-29%20at%202.55.46%20AM.png"></p><p>é—­åŒ…è·¯ç”±ï¼š<br><img src="/media/15956423117442/Screen%20Shot%202020-09-01%20at%207.46.18%20AM.png"><br>æ§åˆ¶å™¨è·¯ç”±<br><img src="/media/15956423117442/Screen%20Shot%202020-09-01%20at%207.41.34%20AM.png"></p><p>è½¬å‘ç»™äº†<br><em>\Hyperf\HttpServer\CoreMiddleware</em>::<code>dispatch</code></p><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">/***@return \Hyperf\HttpServer\Router\Dispatched å®ä¾‹*/</span> <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token variable">$httpMethod</span><span class="token punctuation">,</span> <span class="token variable">$uri</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">staticRouteMap</span><span class="token punctuation">[</span><span class="token variable">$httpMethod</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$uri</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$handler</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">staticRouteMap</span><span class="token punctuation">[</span><span class="token variable">$httpMethod</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$uri</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token punctuation">[</span>self<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">FOUND</span><span class="token punctuation">,</span> <span class="token variable">$handler</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$varRouteData</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">variableRouteData</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$varRouteData</span><span class="token punctuation">[</span><span class="token variable">$httpMethod</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">dispatchVariableRoute</span><span class="token punctuation">(</span><span class="token variable">$varRouteData</span><span class="token punctuation">[</span><span class="token variable">$httpMethod</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$uri</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> self<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">FOUND</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// For HEAD requests, attempt fallback to GET</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$httpMethod</span> <span class="token operator">===</span> <span class="token string">'HEAD'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">staticRouteMap</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$uri</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$handler</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">staticRouteMap</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$uri</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token punctuation">[</span>self<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">FOUND</span><span class="token punctuation">,</span> <span class="token variable">$handler</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$varRouteData</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">dispatchVariableRoute</span><span class="token punctuation">(</span><span class="token variable">$varRouteData</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$uri</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> self<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">FOUND</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// If nothing else matches, try fallback routes</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">staticRouteMap</span><span class="token punctuation">[</span><span class="token string">'*'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$uri</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$handler</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">staticRouteMap</span><span class="token punctuation">[</span><span class="token string">'*'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$uri</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token punctuation">[</span>self<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">FOUND</span><span class="token punctuation">,</span> <span class="token variable">$handler</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$varRouteData</span><span class="token punctuation">[</span><span class="token string">'*'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">dispatchVariableRoute</span><span class="token punctuation">(</span><span class="token variable">$varRouteData</span><span class="token punctuation">[</span><span class="token string">'*'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$uri</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> self<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">FOUND</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// Find allowed methods for this URI by matching against all other HTTP methods as well</span>        <span class="token variable">$allowedMethods</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">staticRouteMap</span> <span class="token keyword">as</span> <span class="token variable">$method</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$uriMap</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$method</span> <span class="token operator">!==</span> <span class="token variable">$httpMethod</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$uriMap</span><span class="token punctuation">[</span><span class="token variable">$uri</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$allowedMethods</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$method</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token comment" spellcheck="true">//        return [self::FOUND, null, []];</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$varRouteData</span> <span class="token keyword">as</span> <span class="token variable">$method</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$routeData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$method</span> <span class="token operator">===</span> <span class="token variable">$httpMethod</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">continue</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">dispatchVariableRoute</span><span class="token punctuation">(</span><span class="token variable">$routeData</span><span class="token punctuation">,</span> <span class="token variable">$uri</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> self<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">FOUND</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$allowedMethods</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$method</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// If there are no allowed methods the route simply does not exist</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$allowedMethods</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token punctuation">[</span>self<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">METHOD_NOT_ALLOWED</span><span class="token punctuation">,</span> <span class="token variable">$allowedMethods</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span>self<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">NOT_FOUND</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="éªŒè¯è¯·æ±‚"><a href="#éªŒè¯è¯·æ±‚" class="headerlink" title="éªŒè¯è¯·æ±‚"></a>éªŒè¯è¯·æ±‚</h4><pre class="line-numbers language-php"><code class="language-php"><span class="token variable">$dispatched</span> <span class="token operator">=</span> <span class="token variable">$psr7Request</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getAttribute</span><span class="token punctuation">(</span>Dispatched<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>æ ¹æ® <span class="token variable">$dispatched</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">isFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span> å€¼æ¥åšå‡ºæ˜¯å¦è¦ä½¿ç”¨è·¯ç”±é…ç½®æ–‡ä»¶é‡Œå®šä¹‰çš„ä¸­é—´ä»¶ã€‚<span class="token variable">$psr7Response</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">dispatcher</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token variable">$psr7Request</span><span class="token punctuation">,</span> <span class="token variable">$middlewares</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">coreMiddleware</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//äº¤ç”±httpåˆ†å‘å™¨æ¥åˆ†å‘httpè¯·æ±‚ã€‚æœ€åç”±HttpRequestHandlerè¯·æ±‚å¤„ç†å™¨æ¥å¤„ç†ï¼Œç»“æœè¦ä¹ˆæŠ›å‡ºå¼‚å¸¸ï¼Œè¦ä¹ˆæ­£å¸¸è¿”å›å“åº”ã€‚</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><hr><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hyperfè·¯ç”± </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2020/09/01/hello-world/"/>
      <url>/2020/09/01/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class="line-numbers language-bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class="line-numbers language-bash"><code class="language-bash">$ hexo server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class="line-numbers language-bash"><code class="language-bash">$ hexo generate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class="line-numbers language-bash"><code class="language-bash">$ hexo deploy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
